VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "clsDao"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

'************************************************************************************
' 機　能    :DB接続情報
' Ver       :1.0.00
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************

'コネクション
Private pCon As ADODB.Connection

'************************************************************************************
' 機　能    :コンストラクタ
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Private Sub Class_Initialize()

    Set pCon = New ADODB.Connection

End Sub
'************************************************************************************
' 機　能    :デストラクタ
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Private Sub Class_Terminate()

    Set pCon = Nothing

End Sub
'************************************************************************************
' 機　能    :セッター_コネクション
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Public Property Set con(ByRef bean As ADODB.Connection)
    Set pCon = bean
End Property

'************************************************************************************
' 機　能    :ゲッター_コネクション
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Public Property Get con() As ADODB.Connection
    Set con = pCon
End Property

'************************************************************************************
' 機　能    :DBコネクションを取得
' 引　数    :in  baseStmt                        コネクションステートメント
'           :in  envBean                         環境情報Bean
' 戻　値    :DBコネクション
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/11/01  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Public Sub conOpen(ByVal baseStmt As String, ByRef envBean As clsEnvBean)
    
    '"Driver={PostgreSQL Unicode};Server={1};Database={2};UID={3};PWD={4};Port={5};INITIAL CATALOG={6};"
    With envBean
        Dim stmt As String
        stmt = ReplacePh(baseStmt, .svr, .db, .ue, .ps, .pt, .sc)
    End With

    con.Open (stmt)

End Sub


'************************************************************************************
' 機　能    :DBクローズ(ここで発生するエラーは無視)
' 引　数    :in  rs                              レコードセット
' 戻　値    :なし
' -----------------------------------------------------------------------------------
' 履　歴　　:2022/10/18  J-Tam  Ver.1.0.00  新規作成
'************************************************************************************
Public Sub conClose(Optional ByRef rs As ADODB.Recordset = Nothing)

    On Error Resume Next

    If pCon.State = adStateOpen Then
        pCon.Close
    End If
    
    If rs.State = adStateOpen Then
        rs.Close
    End If

    On Error GoTo 0

End Sub

